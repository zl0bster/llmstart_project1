# Правила разработки (для ИИ-ассистента)

Источник принципов: см. @vision.md. Не дублируем — ниже только практические правила, влияющие на качество кода.

## Утилиты и инструменты
- **Python 3.11+**: целевая версия интерпретатора (см. @vision.md).
- **aiogram** для Telegram-бота, **openai** клиент для OpenRouter, **pytest** для тестов, **uv** для зависимостей, **Docker** для контейнеров, **Make** для задач — детали в @vision.md.
- Все новые задачи оформляй командами в `Makefile` (build/test/run), не плодить скрипты.

## Основные принципы разработки
- Придерживайся KISS, итеративности, модульности и SRP как описано в @vision.md.
- Отдавай приоритет читаемости и простоте над «магией». Минимум скрытой логики.
- Малые PR: один фокус — одна правка. Ясные сообщения коммитов.

## Стиль кода
- Следуй PEP 8/PEP 257. Именование: полные, говорящие имена; без аббревиатур.
- Пиши функции с явными входами/выходами. Не использовать глобальное состояние.
- Максимум 2–3 уровня вложенности; применять ранние возвраты.
- Типизация `typing` обязательна для публичных функций и API.

## Структура проекта
- Соблюдай структуру из @vision.md.
- `src/bot/`: только `__init__.py` и `handlers.py`. Не создавать `middlewares.py` и `utils.py` без отдельного обоснования и обновления @vision.md.
- `tests/`: содержит `tests/test_bot.py` как базовые тесты (pytest).
- Корень: использовать каталог `.venv/` как локальное виртуальное окружение.

## Работа с зависимостями
- Используй изолированное виртуальное окружение `.venv` в корне проекта для установки зависимостей (не ставить глобально).
- Управление — через **uv**. Фиксируй версии, избегай «latest».
- Разделяй обязательные и dev-зависимости. Не добавляй лишнего.
- Перед добавлением библиотеки — проверяй, нет ли стандартного решения.

## Обработка ошибок
- Принцип fail-fast (см. @vision.md). Явно обрабатывай ожидаемые ошибки; не глуши исключения.
- Логируй ошибки и ключевые события через стандартный `logging` с форматами из @vision.md.
- Пользовательские сообщения об ошибках в боте — короткие, понятные, без внутренних деталей.

## Конфигурация
- Только через переменные окружения из `.env`; шаблон — `.env.example` (см. @vision.md).
- Валидация обязательных переменных при старте; значения по умолчанию — только для необязательных.
- Не хардкодить секреты. Доступ к конфигу — через `src/config.py`.

## Тестирование
- Пиши `pytest`-тесты на новую функциональность. Покрывай happy-path и ключевые негативные случаи.
- Юнит-тесты для чистых функций, интеграционные — для взаимодействий бота и LLM-клиента.
- Тесты должны быть детерминированными; изоляция внешних сервисов — моками/фейками.
