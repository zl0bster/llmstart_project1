# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –∏ –∞–Ω–∞–ª–∏–∑—É –ª–æ–≥–æ–≤.

## –û–±–∑–æ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –¶–µ–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏** ‚Äî –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äî –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- **–í—ã—è–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫** ‚Äî –ø—Ä–æ–±–ª–µ–º—ã —Å API, —Å–µ—Ç—å—é, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **Uptime** ‚Äî –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
- **Response time** ‚Äî –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- **Error rate** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫
- **Token usage** ‚Äî —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ LLM
- **User activity** ‚Äî –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

#### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
```
2024-01-15 10:30:45,123 INFO bot.handlers: –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 12345
2024-01-15 10:30:45,456 INFO llm_client: LLM –∑–∞–ø—Ä–æ—Å: 1 —Å–æ–æ–±—â–µ–Ω–∏–π, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 1.2s
2024-01-15 10:30:45,789 INFO bot.handlers: –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 12345
```

#### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **DEBUG** ‚Äî –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- **INFO** ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **WARNING** ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **ERROR** ‚Äî –æ—à–∏–±–∫–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```python
# –í src/bot.py
import logging

def setup_logging():
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è."""
    config = get_config()
    
    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
    os.makedirs(os.path.dirname(config['LOG_FILE']), exist_ok=True)
    
    logging.basicConfig(
        level=getattr(logging, config['LOG_LEVEL']),
        format='%(asctime)s %(levelname)s %(name)s: %(message)s',
        handlers=[
            logging.FileHandler(config['LOG_FILE'], encoding='utf-8'),
            logging.StreamHandler()
        ]
    )
```

#### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```python
# –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
def setup_advanced_logging():
    """–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è."""
    config = get_config()
    
    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
    os.makedirs(os.path.dirname(config['LOG_FILE']), exist_ok=True)
    
    # –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
    formatter = logging.Formatter(
        '%(asctime)s %(levelname)s %(name)s:%(lineno)d: %(message)s',
        datefmt='%Y-%m-%d %H:%M:%S'
    )
    
    # –§–∞–π–ª–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    file_handler = logging.FileHandler(config['LOG_FILE'], encoding='utf-8')
    file_handler.setFormatter(formatter)
    file_handler.setLevel(logging.INFO)
    
    # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    console_handler.setLevel(logging.WARNING)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞
    root_logger = logging.getLogger()
    root_logger.setLevel(logging.DEBUG)
    root_logger.addHandler(file_handler)
    root_logger.addHandler(console_handler)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–æ–≤ –º–æ–¥—É–ª–µ–π
    logging.getLogger('src.handlers').setLevel(logging.INFO)
    logging.getLogger('src.llm_client').setLevel(logging.INFO)
    logging.getLogger('aiogram').setLevel(logging.WARNING)
    logging.getLogger('openai').setLevel(logging.WARNING)
```

### –ß—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
```python
# –í src/handlers.py
import logging

logger = logging.getLogger(__name__)

async def handle_text_message(message: Message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π."""
    user_id = message.from_user.id
    chat_id = message.chat.id
    user_text = message.text
    
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}: {user_text[:50]}...")
    
    try:
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
        response = await generate_llm_response(user_text, chat_id)
        
        # –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
        await message.answer(response)
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        logger.info(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {response[:50]}...")
        
    except Exception as e:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç {user_id}: {e}")
        await message.answer("–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.")
```

#### LLM –∑–∞–ø—Ä–æ—Å—ã
```python
# –í src/llm_client.py
import logging
import time

logger = logging.getLogger(__name__)

async def generate_response(messages: List[Dict], chat_id: int) -> str:
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ LLM."""
    start_time = time.time()
    
    try:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
        logger.info(f"LLM –∑–∞–ø—Ä–æ—Å: {len(messages)} —Å–æ–æ–±—â–µ–Ω–∏–π, –º–æ–¥–µ–ª—å: {config['LLM_MODEL_NAME']}")
        
        # –í—ã–∑–æ–≤ API
        response = await client.chat.completions.create(
            model=config['LLM_MODEL_NAME'],
            messages=messages,
            temperature=config['LLM_TEMPERATURE'],
            max_tokens=config['LLM_MAX_TOKENS']
        )
        
        # –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
        response_time = time.time() - start_time
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        logger.info(f"LLM –æ—Ç–≤–µ—Ç: {len(response.choices[0].message.content)} —Å–∏–º–≤–æ–ª–æ–≤, "
                   f"–≤—Ä–µ–º—è: {response_time:.2f}s")
        
        return response.choices[0].message.content
        
    except Exception as e:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
        response_time = time.time() - start_time
        logger.error(f"–û—à–∏–±–∫–∞ LLM: {e}, –≤—Ä–µ–º—è: {response_time:.2f}s")
        return "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞."
```

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
```python
# –í src/bot.py
import logging

logger = logging.getLogger(__name__)

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞."""
    try:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞
        logger.info("–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        setup_logging()
        config = get_config()
        logger.info("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
        bot = Bot(token=config['TELEGRAM_BOT_TOKEN'])
        dp = Dispatcher(storage=MemoryStorage())
        register_handlers(dp)
        logger.info("–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã")
        
        # –ó–∞–ø—É—Å–∫
        logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ")
        asyncio.run(dp.start_polling(bot))
        
    except Exception as e:
        logger.error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞: {e}")
        raise
    finally:
        logger.info("–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
```

## –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

#### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π
tail -n 100 logs/bot.log

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/bot.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep -i error logs/bot.log

# –ü–æ–∏—Å–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
grep -i warning logs/bot.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º
grep -c "INFO" logs/bot.log
grep -c "WARNING" logs/bot.log
grep -c "ERROR" logs/bot.log
```

#### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–æ–≤ LLM
grep "LLM –æ—Ç–≤–µ—Ç" logs/bot.log | grep -o "–≤—Ä–µ–º—è: [0-9.]*s"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
grep "LLM –∑–∞–ø—Ä–æ—Å" logs/bot.log | wc -l

# –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
grep "LLM –æ—Ç–≤–µ—Ç" logs/bot.log | grep -o "–≤—Ä–µ–º—è: [0-9.]*s" | sed 's/–≤—Ä–µ–º—è: //' | sed 's/s//' | awk '{sum+=$1; count++} END {print sum/count}'
```

#### –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```bash
# –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
grep "–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" logs/bot.log | grep -o "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [0-9]*" | sort -u

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
grep "–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 12345" logs/bot.log | wc -l

# –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏
grep "–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ" logs/bot.log | grep -o "[0-9][0-9]:[0-9][0-9]" | sort | uniq -c
```

### –°–∫—Ä–∏–ø—Ç—ã –∞–Ω–∞–ª–∏–∑–∞

#### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
# scripts/analyze_performance.py
import re
import statistics
from datetime import datetime

def analyze_performance(log_file):
    """–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –ª–æ–≥–∞–º."""
    response_times = []
    
    with open(log_file, 'r', encoding='utf-8') as f:
        for line in f:
            # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
            match = re.search(r'–≤—Ä–µ–º—è: ([0-9.]+)s', line)
            if match:
                response_times.append(float(match.group(1)))
    
    if response_times:
        print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤: {len(response_times)}")
        print(f"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {statistics.mean(response_times):.2f}s")
        print(f"–ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {statistics.median(response_times):.2f}s")
        print(f"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {max(response_times):.2f}s")
        print(f"–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {min(response_times):.2f}s")
    else:
        print("–î–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")

if __name__ == "__main__":
    analyze_performance("logs/bot.log")
```

#### –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫
```python
# scripts/analyze_errors.py
import re
from collections import Counter

def analyze_errors(log_file):
    """–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –ø–æ –ª–æ–≥–∞–º."""
    errors = []
    
    with open(log_file, 'r', encoding='utf-8') as f:
        for line in f:
            if "ERROR" in line:
                # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
                match = re.search(r'ERROR.*: (.*)', line)
                if match:
                    errors.append(match.group(1))
    
    if errors:
        print(f"–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫: {len(errors)}")
        print("\n–¢–æ–ø-5 –æ—à–∏–±–æ–∫:")
        error_counts = Counter(errors)
        for error, count in error_counts.most_common(5):
            print(f"  {count}x: {error}")
    else:
        print("–û—à–∏–±–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")

if __name__ == "__main__":
    analyze_errors("logs/bot.log")
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### Health checks

#### –ü—Ä–æ—Å—Ç–æ–π health check
```python
# scripts/health_check.py
import requests
import time
import logging

def health_check():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±–æ—Ç–∞."""
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤
        with open("logs/bot.log", "r") as f:
            lines = f.readlines()
            last_line = lines[-1] if lines else ""
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –±–æ—Ç –Ω–µ–¥–∞–≤–Ω–æ –ø–∏—Å–∞–ª –≤ –ª–æ–≥–∏
            if "ERROR" in last_line:
                return False, "–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö"
            
            return True, "–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç"
            
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: {e}"

if __name__ == "__main__":
    while True:
        is_healthy, message = health_check()
        status = "OK" if is_healthy else "ERROR"
        print(f"{time.strftime('%Y-%m-%d %H:%M:%S')} - {status}: {message}")
        time.sleep(60)
```

#### Docker health check
```dockerfile
# –í Dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD python -c "import sys; sys.exit(0)"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
```python
# scripts/monitor_resources.py
import psutil
import time
import logging

def monitor_resources():
    """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤."""
    process = psutil.Process()
    
    while True:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
        memory_info = process.memory_info()
        cpu_percent = process.cpu_percent()
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        logging.info(f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: {memory_info.rss / 1024 / 1024:.2f} MB")
        logging.info(f"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU: {cpu_percent:.2f}%")
        
        time.sleep(60)

if __name__ == "__main__":
    monitor_resources()
```

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–∞
```bash
# –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–∏—Å–∫–∞
#!/bin/bash
while true; do
    disk_usage=$(df -h logs/ | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ $disk_usage -gt 80 ]; then
        echo "WARNING: –î–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞ $disk_usage%"
        # –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
        mv logs/bot.log logs/bot.log.old
        touch logs/bot.log
    fi
    sleep 300
done
```

## –ê–ª–µ—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

#### –ê–ª–µ—Ä—Ç –Ω–∞ –æ—à–∏–±–∫–∏
```python
# scripts/error_alert.py
import smtplib
from email.mime.text import MIMEText
import logging

def send_error_alert(error_message):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ –æ–± –æ—à–∏–±–∫–µ."""
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SMTP
    smtp_server = "smtp.gmail.com"
    smtp_port = 587
    username = "your-email@gmail.com"
    password = "your-password"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    msg = MIMEText(f"–û—à–∏–±–∫–∞ –≤ –±–æ—Ç–µ: {error_message}")
    msg['Subject'] = "–û—à–∏–±–∫–∞ Telegram –±–æ—Ç–∞"
    msg['From'] = username
    msg['To'] = "admin@company.com"
    
    # –û—Ç–ø—Ä–∞–≤–∫–∞
    try:
        server = smtplib.SMTP(smtp_server, smtp_port)
        server.starttls()
        server.login(username, password)
        server.send_message(msg)
        server.quit()
        logging.info("–ê–ª–µ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–ª–µ—Ä—Ç–∞: {e}")
```

#### –ê–ª–µ—Ä—Ç –Ω–∞ –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É
```python
# scripts/load_alert.py
import time
import logging

def check_load():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–æ—Ç–∞."""
    # –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
    current_time = time.time()
    five_minutes_ago = current_time - 300
    
    request_count = 0
    with open("logs/bot.log", "r") as f:
        for line in f:
            if "LLM –∑–∞–ø—Ä–æ—Å" in line:
                # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ –ª–æ–≥–∞
                # ... –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ ...
                pass
    
    # –ê–ª–µ—Ä—Ç –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
    if request_count > 100:  # –ë–æ–ª–µ–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 5 –º–∏–Ω—É—Ç
        send_load_alert(request_count)

def send_load_alert(request_count):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ –æ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ."""
    logging.warning(f"–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: {request_count} –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 5 –º–∏–Ω—É—Ç")
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

#### Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```python
# scripts/telegram_alert.py
import asyncio
from aiogram import Bot

async def send_telegram_alert(message):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ –≤ Telegram."""
    bot = Bot(token="YOUR_ADMIN_BOT_TOKEN")
    admin_chat_id = "YOUR_ADMIN_CHAT_ID"
    
    try:
        await bot.send_message(admin_chat_id, f"üö® –ê–ª–µ—Ä—Ç: {message}")
        await bot.session.close()
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram –∞–ª–µ—Ä—Ç–∞: {e}")
```

#### Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```python
# scripts/webhook_alert.py
import requests
import json

def send_webhook_alert(message):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–∞ —á–µ—Ä–µ–∑ webhook."""
    webhook_url = "https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
    
    payload = {
        "text": f"üö® –û—à–∏–±–∫–∞ –≤ –±–æ—Ç–µ: {message}",
        "channel": "#alerts",
        "username": "Bot Monitor"
    }
    
    try:
        response = requests.post(webhook_url, json=payload)
        if response.status_code == 200:
            logging.info("Webhook –∞–ª–µ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω")
        else:
            logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook: {response.status_code}")
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ webhook: {e}")
```

## –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏

#### –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è
```python
# scripts/log_rotation.py
import os
import time
from datetime import datetime

def rotate_logs():
    """–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤."""
    log_file = "logs/bot.log"
    
    if os.path.exists(log_file):
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        file_size = os.path.getsize(log_file)
        max_size = 10 * 1024 * 1024  # 10 MB
        
        if file_size > max_size:
            # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            backup_file = f"logs/bot_{timestamp}.log"
            
            os.rename(log_file, backup_file)
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤
            open(log_file, 'a').close()
            
            logging.info(f"–õ–æ–≥–∏ —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω—ã: {backup_file}")
            
            # –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
            cleanup_old_logs()

def cleanup_old_logs():
    """–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤."""
    log_dir = "logs/"
    current_time = time.time()
    max_age = 30 * 24 * 60 * 60  # 30 –¥–Ω–µ–π
    
    for filename in os.listdir(log_dir):
        if filename.startswith("bot_") and filename.endswith(".log"):
            file_path = os.path.join(log_dir, filename)
            file_age = current_time - os.path.getmtime(file_path)
            
            if file_age > max_age:
                os.remove(file_path)
                logging.info(f"–£–¥–∞–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –ª–æ–≥: {filename}")

if __name__ == "__main__":
    rotate_logs()
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è
```bash
# Crontab –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–∏
# –†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
0 2 * * * /path/to/script/log_rotation.py

# –†–æ—Ç–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
* * * * * /path/to/script/log_rotation.py
```

## –î–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü—Ä–æ—Å—Ç–æ–π –¥–∞—à–±–æ—Ä–¥
```python
# scripts/dashboard.py
from flask import Flask, render_template
import json
import re
from datetime import datetime, timedelta

app = Flask(__name__)

def get_stats():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –ª–æ–≥–æ–≤."""
    stats = {
        'total_requests': 0,
        'error_count': 0,
        'avg_response_time': 0,
        'active_users': 0
    }
    
    # –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
    with open("logs/bot.log", "r") as f:
        for line in f:
            if "LLM –∑–∞–ø—Ä–æ—Å" in line:
                stats['total_requests'] += 1
            elif "ERROR" in line:
                stats['error_count'] += 1
    
    return stats

@app.route('/')
def dashboard():
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–∞—à–±–æ—Ä–¥–∞."""
    stats = get_stats()
    return render_template('dashboard.html', stats=stats)

if __name__ == "__main__":
    app.run(host='0.0.0.0', port=5000)
```

### HTML —à–∞–±–ª–æ–Ω
```html
<!-- templates/dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Bot Dashboard</title>
    <meta http-equiv="refresh" content="30">
</head>
<body>
    <h1>Telegram Bot Dashboard</h1>
    
    <div class="stats">
        <div class="stat">
            <h3>–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
            <p>{{ stats.total_requests }}</p>
        </div>
        
        <div class="stat">
            <h3>–û—à–∏–±–∫–∏</h3>
            <p>{{ stats.error_count }}</p>
        </div>
        
        <div class="stat">
            <h3>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</h3>
            <p>{{ stats.avg_response_time }}s</p>
        </div>
        
        <div class="stat">
            <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <p>{{ stats.active_users }}</p>
        </div>
    </div>
</body>
</html>
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/bot.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep -i error logs/bot.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
grep "LLM –∑–∞–ø—Ä–æ—Å" logs/bot.log | wc -l

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
top -p $(pgrep -f "python src/bot.py")
```

### –ê–Ω–∞–ª–∏–∑
```bash
# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
python scripts/analyze_performance.py

# –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫
python scripts/analyze_errors.py

# Health check
python scripts/health_check.py
```

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](troubleshooting.md)
